#!/usr/bin/env sh

# Run pre-commit framework (includes yamllint, shellcheck, etc.)
if command -v pre-commit >/dev/null 2>&1; then
  echo "üîç Running pre-commit hooks..."
  pre-commit run --hook-stage pre-commit || {
    echo "‚ùå Pre-commit checks failed. Fix issues and try again."
    exit 1
  }
else
  echo "‚ö†Ô∏è  pre-commit not installed, skipping framework checks"
fi

# Check markdown linting (staged files only)
echo "üîç Checking markdown files (staged)..."
STAGED_MD_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\\.md$' || true)
if [ -n "$STAGED_MD_FILES" ]; then
  echo "$STAGED_MD_FILES" | xargs markdownlint-cli2 || {
    echo "‚ùå Markdown linting failed on staged files. Fix issues or run 'pnpm run lint:md:fix'."
    exit 1
  }
else
  echo "(no staged markdown changes)"
fi

echo "‚úÖ All pre-commit checks passed!"
