name = "vessel-ner-ocr-processor"
main = "src/workers/ocr-processor.ts"
compatibility_date = "2025-01-07"
compatibility_flags = ["nodejs_compat_v2"]

account_id = "8fa97474778c8a894925c148ca829739"

# R2 bucket binding
[[r2_buckets]]
binding = "VESSEL_PDFS"
bucket_name = "vessel-pdfs"

# Queue consumer
[[queues.consumers]]
queue = "pdf-processing"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "pdf-processing-dlq"

# Queue producer (for entity-extraction)
[[queues.producers]]
queue = "entity-extraction"
binding = "ENTITY_EXTRACTION_QUEUE"

# Environment variables
[vars]
DEEPSEEK_OCR_SPACE_URL = "https://huggingface.co/spaces/goldfish-inc/deepseekocr"
USE_DIRECT_UPLOAD = "false"  # Feature flag: Use direct Gradio /call/ API instead of @gradio/client

# R2 Parquet output configuration
R2_ENDPOINT = "https://8fa97474778c8a894925c148ca829739.r2.cloudflarestorage.com"
R2_PARQUET_BUCKET = "vessel-parquet"

# Provenance tracking
HF_SPACE_COMMIT = "main"  # Update with actual commit SHA
OCR_MODEL_VERSION = "deepseek-ocr-3b"
OCR_IMAGE_DIGEST = "latest"

# Secrets (set via: pnpm exec wrangler secret put <NAME>)
# HF_TOKEN - HuggingFace API token
# R2_ACCESS_KEY_ID - R2 API access key ID
# R2_SECRET_ACCESS_KEY - R2 API secret access key
