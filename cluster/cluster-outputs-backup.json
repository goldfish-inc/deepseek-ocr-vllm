{
  "cloudflareMetricsUrl": "http://cloudflared-metrics.cloudflare.svc.cluster.local:2000/metrics",
  "cloudflaredDeployment": {
    "apiVersion": "apps/v1",
    "id": "cloudflare/cloudflared",
    "kind": "Deployment",
    "metadata": {
      "annotations": {
        "deployment.kubernetes.io/revision": "1"
      },
      "creationTimestamp": "2025-09-25T15:48:34Z",
      "generation": 1,
      "labels": {
        "oceanid.cluster/component": "networking"
      },
      "managedFields": [
        {
          "apiVersion": "apps/v1",
          "fieldsType": "FieldsV1",
          "fieldsV1": {
            "f:metadata": {
              "f:labels": {
                "f:oceanid.cluster/component": {}
              }
            },
            "f:spec": {
              "f:replicas": {},
              "f:selector": {},
              "f:template": {
                "f:metadata": {
                  "f:annotations": {
                    "f:prometheus.io/port": {},
                    "f:prometheus.io/scrape": {}
                  },
                  "f:labels": {
                    "f:app": {},
                    "f:oceanid.cluster/component": {}
                  }
                },
                "f:spec": {
                  "f:containers": {
                    "k:{\"name\":\"cloudflared\"}": {
                      ".": {},
                      "f:args": {},
                      "f:env": {
                        "k:{\"name\":\"TUNNEL_LOGLEVEL\"}": {
                          ".": {},
                          "f:name": {},
                          "f:value": {}
                        },
                        "k:{\"name\":\"TUNNEL_METRICS\"}": {
                          ".": {},
                          "f:name": {},
                          "f:value": {}
                        },
                        "k:{\"name\":\"TUNNEL_TOKEN\"}": {
                          ".": {},
                          "f:name": {},
                          "f:valueFrom": {
                            "f:secretKeyRef": {}
                          }
                        }
                      },
                      "f:image": {},
                      "f:livenessProbe": {
                        "f:httpGet": {
                          "f:path": {},
                          "f:port": {}
                        },
                        "f:initialDelaySeconds": {},
                        "f:periodSeconds": {}
                      },
                      "f:name": {},
                      "f:ports": {
                        "k:{\"containerPort\":2000,\"protocol\":\"TCP\"}": {
                          ".": {},
                          "f:containerPort": {},
                          "f:name": {}
                        }
                      },
                      "f:readinessProbe": {
                        "f:httpGet": {
                          "f:path": {},
                          "f:port": {}
                        },
                        "f:initialDelaySeconds": {},
                        "f:periodSeconds": {}
                      },
                      "f:resources": {
                        "f:limits": {
                          "f:cpu": {},
                          "f:memory": {}
                        },
                        "f:requests": {
                          "f:cpu": {},
                          "f:memory": {}
                        }
                      },
                      "f:securityContext": {
                        "f:allowPrivilegeEscalation": {},
                        "f:capabilities": {
                          "f:drop": {}
                        },
                        "f:readOnlyRootFilesystem": {},
                        "f:runAsNonRoot": {},
                        "f:runAsUser": {},
                        "f:seccompProfile": {
                          "f:type": {}
                        }
                      },
                      "f:volumeMounts": {
                        "k:{\"mountPath\":\"/etc/cloudflared/config\"}": {
                          ".": {},
                          "f:mountPath": {},
                          "f:name": {},
                          "f:readOnly": {}
                        },
                        "k:{\"mountPath\":\"/etc/cloudflared/creds\"}": {
                          ".": {},
                          "f:mountPath": {},
                          "f:name": {},
                          "f:readOnly": {}
                        }
                      }
                    }
                  },
                  "f:securityContext": {
                    "f:fsGroup": {}
                  },
                  "f:serviceAccountName": {},
                  "f:volumes": {
                    "k:{\"name\":\"config\"}": {
                      ".": {},
                      "f:configMap": {
                        "f:items": {},
                        "f:name": {}
                      },
                      "f:name": {}
                    },
                    "k:{\"name\":\"creds\"}": {
                      ".": {},
                      "f:name": {},
                      "f:secret": {
                        "f:secretName": {}
                      }
                    }
                  }
                }
              }
            }
          },
          "manager": "pulumi-kubernetes-92c5173b",
          "operation": "Apply",
          "time": "2025-09-25T15:48:34Z"
        },
        {
          "apiVersion": "apps/v1",
          "fieldsType": "FieldsV1",
          "fieldsV1": {
            "f:metadata": {
              "f:annotations": {
                ".": {},
                "f:deployment.kubernetes.io/revision": {}
              }
            },
            "f:status": {
              "f:availableReplicas": {},
              "f:conditions": {
                ".": {},
                "k:{\"type\":\"Available\"}": {
                  ".": {},
                  "f:lastTransitionTime": {},
                  "f:lastUpdateTime": {},
                  "f:message": {},
                  "f:reason": {},
                  "f:status": {},
                  "f:type": {}
                },
                "k:{\"type\":\"Progressing\"}": {
                  ".": {},
                  "f:lastTransitionTime": {},
                  "f:lastUpdateTime": {},
                  "f:message": {},
                  "f:reason": {},
                  "f:status": {},
                  "f:type": {}
                }
              },
              "f:observedGeneration": {},
              "f:readyReplicas": {},
              "f:replicas": {},
              "f:updatedReplicas": {}
            }
          },
          "manager": "k3s",
          "operation": "Update",
          "subresource": "status",
          "time": "2025-09-25T15:48:48Z"
        }
      ],
      "name": "cloudflared",
      "namespace": "cloudflare",
      "resourceVersion": "17176",
      "uid": "7bcc3c80-d53e-4331-a079-c94805e30485"
    },
    "spec": {
      "progressDeadlineSeconds": 600,
      "replicas": 2,
      "revisionHistoryLimit": 10,
      "selector": {
        "matchLabels": {
          "app": "cloudflared"
        }
      },
      "strategy": {
        "rollingUpdate": {
          "maxSurge": "25%",
          "maxUnavailable": "25%"
        },
        "type": "RollingUpdate"
      },
      "template": {
        "metadata": {
          "annotations": {
            "prometheus.io/port": "2000",
            "prometheus.io/scrape": "true"
          },
          "labels": {
            "app": "cloudflared",
            "oceanid.cluster/component": "networking"
          }
        },
        "spec": {
          "containers": [
            {
              "args": [
                "tunnel",
                "--config",
                "/etc/cloudflared/config/config.yaml",
                "--metrics",
                "0.0.0.0:2000",
                "run"
              ],
              "env": [
                {
                  "name": "TUNNEL_TOKEN",
                  "valueFrom": {
                    "secretKeyRef": {
                      "key": "token",
                      "name": "cloudflared-credentials"
                    }
                  }
                },
                {
                  "name": "TUNNEL_METRICS",
                  "value": "0.0.0.0:2000"
                },
                {
                  "name": "TUNNEL_LOGLEVEL",
                  "value": "info"
                }
              ],
              "image": "cloudflare/cloudflared:latest",
              "imagePullPolicy": "Always",
              "livenessProbe": {
                "failureThreshold": 3,
                "httpGet": {
                  "path": "/ready",
                  "port": 2000,
                  "scheme": "HTTP"
                },
                "initialDelaySeconds": 10,
                "periodSeconds": 30,
                "successThreshold": 1,
                "timeoutSeconds": 1
              },
              "name": "cloudflared",
              "ports": [
                {
                  "containerPort": 2000,
                  "name": "metrics",
                  "protocol": "TCP"
                }
              ],
              "readinessProbe": {
                "failureThreshold": 3,
                "httpGet": {
                  "path": "/ready",
                  "port": 2000,
                  "scheme": "HTTP"
                },
                "initialDelaySeconds": 5,
                "periodSeconds": 10,
                "successThreshold": 1,
                "timeoutSeconds": 1
              },
              "resources": {
                "limits": {
                  "cpu": "200m",
                  "memory": "256Mi"
                },
                "requests": {
                  "cpu": "100m",
                  "memory": "128Mi"
                }
              },
              "securityContext": {
                "allowPrivilegeEscalation": false,
                "capabilities": {
                  "drop": [
                    "ALL"
                  ]
                },
                "readOnlyRootFilesystem": true,
                "runAsNonRoot": true,
                "runAsUser": 65532,
                "seccompProfile": {
                  "type": "RuntimeDefault"
                }
              },
              "terminationMessagePath": "/dev/termination-log",
              "terminationMessagePolicy": "File",
              "volumeMounts": [
                {
                  "mountPath": "/etc/cloudflared/config",
                  "name": "config",
                  "readOnly": true
                },
                {
                  "mountPath": "/etc/cloudflared/creds",
                  "name": "creds",
                  "readOnly": true
                }
              ]
            }
          ],
          "dnsPolicy": "ClusterFirst",
          "restartPolicy": "Always",
          "schedulerName": "default-scheduler",
          "securityContext": {
            "fsGroup": 65532
          },
          "serviceAccount": "cloudflared",
          "serviceAccountName": "cloudflared",
          "terminationGracePeriodSeconds": 30,
          "volumes": [
            {
              "configMap": {
                "defaultMode": 420,
                "items": [
                  {
                    "key": "config.yaml",
                    "path": "config.yaml"
                  }
                ],
                "name": "cloudflared-config"
              },
              "name": "config"
            },
            {
              "name": "creds",
              "secret": {
                "defaultMode": 420,
                "secretName": "cloudflared-credentials"
              }
            }
          ]
        }
      }
    },
    "status": {
      "availableReplicas": 2,
      "conditions": [
        {
          "lastTransitionTime": "2025-09-25T15:48:48Z",
          "lastUpdateTime": "2025-09-25T15:48:48Z",
          "message": "Deployment has minimum availability.",
          "reason": "MinimumReplicasAvailable",
          "status": "True",
          "type": "Available"
        },
        {
          "lastTransitionTime": "2025-09-25T15:48:34Z",
          "lastUpdateTime": "2025-09-25T15:48:48Z",
          "message": "ReplicaSet \"cloudflared-5f6dfc579f\" has successfully progressed.",
          "reason": "NewReplicaSetAvailable",
          "status": "True",
          "type": "Progressing"
        }
      ],
      "observedGeneration": 1,
      "readyReplicas": 2,
      "replicas": 2,
      "updatedReplicas": 2
    },
    "urn": "urn:pulumi:prod::oceanid-cluster::kubernetes:apps/v1:Deployment::cloudflared"
  },
  "clusterEndpoint": "https://157.173.210.123:6443",
  "components": {
    "monitoring": "Sentry (External)",
    "networking": "Cloudflare Tunnels + Gateway API (2025 Standard)",
    "secrets": "Pulumi ESC (Environments, Secrets, Configuration)",
    "security": "Network Policies + RBAC + Pod Security Standards",
    "storage": "Persistent Volumes via k3s local-path"
  },
  "gatewayUrl": "http://oceanid-gateway.gateway-system.svc.cluster.local",
  "internalNetworkPolicy": {
    "apiVersion": "networking.k8s.io/v1",
    "id": "default/allow-internal-communication",
    "kind": "NetworkPolicy",
    "metadata": {
      "creationTimestamp": "2025-09-25T15:45:48Z",
      "generation": 1,
      "labels": {
        "oceanid.cluster/component": "network-policy"
      },
      "managedFields": [
        {
          "apiVersion": "networking.k8s.io/v1",
          "fieldsType": "FieldsV1",
          "fieldsV1": {
            "f:metadata": {
              "f:labels": {
                "f:oceanid.cluster/component": {}
              }
            },
            "f:spec": {
              "f:egress": {},
              "f:ingress": {},
              "f:podSelector": {},
              "f:policyTypes": {}
            }
          },
          "manager": "pulumi-kubernetes-47083736",
          "operation": "Apply",
          "time": "2025-09-25T15:45:48Z"
        }
      ],
      "name": "allow-internal-communication",
      "namespace": "default",
      "resourceVersion": "17024",
      "uid": "7ee9b6a2-845e-4ff2-9bed-2870fd9a2918"
    },
    "spec": {
      "egress": [
        {
          "to": [
            {
              "namespaceSelector": {}
            },
            {
              "podSelector": {}
            }
          ]
        }
      ],
      "ingress": [
        {
          "from": [
            {
              "namespaceSelector": {}
            },
            {
              "podSelector": {}
            }
          ]
        }
      ],
      "podSelector": {},
      "policyTypes": [
        "Ingress",
        "Egress"
      ]
    },
    "urn": "urn:pulumi:prod::oceanid-cluster::kubernetes:networking.k8s.io/v1:NetworkPolicy::allow-internal"
  },
  "status": "Oceanid Cluster - 100% Pulumi Infrastructure with ESC"
}
