# Join-key configuration for row alignment
# Use IMO as default join key to handle row reordering between baseline and pipeline
# When join_key is set, rows are aligned by this stable identifier instead of row_index
# This fixes symmetric baseline-only/pipeline-only mismatches (IOTC, CCSBT, PNA)
join_key: IMO  # Global default (can be overridden per-RFMO or set to null to disable)

# Composite keys (Phase D): used when join_key missing or duplicate
# Global default and per-RFMO overrides. Keys are canonicalized (uppercase names).
composite_keys:
  - IMO
  - VESSEL_NAME
composite_overrides:
  IOTC:
    # Prefer IMO+NAME; fallback to NAME+FLAG_STATE_CODE+REGNO
    - [IMO, VESSEL_NAME]
    - [VESSEL_NAME, FLAG_STATE_CODE, REGNO]
  PNA:
    - [IMO, VESSEL_NAME]
  CCSBT:
    # Primary: VESSEL_REGISTRATION_NUMBER + VESSEL_NAME
    # Fallbacks: CCSBT_REGISTRATION_NUMBER + VESSEL_NAME, IMO + VESSEL_NAME
    - [VESSEL_REGISTRATION_NUMBER, VESSEL_NAME]
    - [CCSBT_REGISTRATION_NUMBER, VESSEL_NAME]
    - [IMO, VESSEL_NAME]
    - [IMO, FLAG]
    - [CALL_SIGN, VESSEL_NAME]

aliases:
  # Column name aliases (all normalized to uppercase with underscores)
  IMO_NUMBER: IMO
  IMO_NO: IMO
  IMO_NO_: IMO
  CALLSIGN: CALL_SIGN
  # Note: NAFO-specific mappings (VESSEL_NAME→NAME, FLAG→COUNTRYID, RADIO→IRCS)
  # are NOT included here as they break other RFMOs. NAFO baseline already uses
  # canonical names, so no aliases needed.

case_insensitive_columns:
  # Columns where case should be ignored during comparison
  - FLAG
  - COUNTRYID

# Date normalization configuration
date_columns:
  # Restrict date parsing to known date columns to avoid false positives
  # Empty list = apply to all columns (backward compat)
  # Populated list = only apply to these specific columns
  []
  # - CONFIRMATION_DATE
  # - LAST_MODIFICATION
  # - REGISTRATION_DATE
  # - AUTHORIZATION_START
  # - AUTHORIZATION_END
  # - DATE_OF_ISSUE
  # - EXPIRY_DATE
  # - YEAR_BUILT
  # - SOURCEGOLDFISHUPDATE
  # - SOURCEREFRESHDATE

# Unicode normalization
unicode:
  # Normalize all text to NFC (canonical composition)
  # Reduces false positives from different Unicode representations
  normalize: NFC

  # Accent-insensitive comparison
  # Empty list = strict comparison (diacritics preserved in extraction pipeline per #261)
  accent_insensitive_columns: []

# Composite-key-only normalization (surgical; affects key assembly only)
composite_key_normalization:
  enabled: true
  rules:
    strip_quotes: true
    strip_apostrophes: true
    ampersand_to_and: true
    compress_whitespace: true
    remove_degree_symbol: true

# Value normalization mappings
value_mappings:
  # Country code mappings (ISO 3166-1 alpha-3 → alpha-2)
  COUNTRYID:
    GBR: GB
    USA: US
    FRA: FR
    DEU: DE
    ESP: ES
    ITA: IT
    NLD: NL
    BEL: BE
    PRT: PT
    GRC: GR
    SWE: SE
    DNK: DK
    NOR: NO
    FIN: FI
    POL: PL
    IRL: IE
    AUT: AT
    CHE: CH
    CZE: CZ
    HUN: HU
    ROU: RO
    BGR: BG
    HRV: HR
    SVN: SI
    SVK: SK
    LTU: LT
    LVA: LV
    EST: EE
    CYP: CY
    MLT: MT
    LUX: LU
    ISL: IS

  FLAG:
    GBR: GB
    USA: US
    FRA: FR
    DEU: DE
    ESP: ES
    ITA: IT
    NLD: NL
    BEL: BE
    PRT: PT
    GRC: GR
    SWE: SE
    DNK: DK
    NOR: NO
    FIN: FI
    POL: PL
    IRL: IE
    AUT: AT
    CHE: CH
    CZE: CZ
    HUN: HU
    ROU: RO
    BGR: BG
    HRV: HR
    SVN: SI
    SVK: SK
    LTU: LT
    LVA: LV
    EST: EE
    CYP: CY
    MLT: MT
    LUX: LU
    ISL: IS

# Per-column numeric precision
numeric:
  # Specify rounding precision for numeric columns
  # Format: COLUMN_NAME: precision (decimal places)
  BEAM_M: 2
  DEPTH_M: 2
  LENGTH_M: 2
  LENGTH_OA_M: 2
  GROSS_TONNAGE: 2
  GROSS_TONNAGE_T: 2
  NET_TONNAGE: 2
  ENGINE_POWER_KW: 0
  ENGINE_POWER_HP: 0

ignore_transformations:
  date_formats: true     # Enable dual-scheme date normalization
  float_precision: null  # Use per-column numeric config instead
  whitespace: true       # Trim leading/trailing whitespace

# Null-aware diff configuration
null_values:
  # Tokens that represent missing/null values (normalized before all other transformations)
  # Empty string is always treated as null
  - ""
  - "N/A"
  - "NA"
  - "NONE"
  - "NULL"
  - "—"
  - "-"
  - "Not Available"
  - "Unknown"
  - "n/a"
  - "null"

null_categories:
  # Map null tokens to semantic categories (preserves "why null" signal)
  # Used for reporting information gain/loss patterns
  "N/A": "not_applicable"
  "NA": "not_applicable"
  "Not Available": "not_available"
  "NONE": "unknown"
  "NULL": "unknown"
  "Unknown": "unknown"
  "—": "not_provided"
  "-": "not_provided"

null_policy:
  # Controls how null matches are scored in match_rate calculations
  count_match_null_as_positive: true    # Both null = valid match (intelligence gathering mindset)
  count_info_gain_as_positive: true     # Baseline null → pipeline value = gain (reward filling gaps)
  count_info_loss_as_negative: true     # Baseline value → pipeline null = loss (penalize data loss)
